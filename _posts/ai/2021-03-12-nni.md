---
title: "nni"
categories:
    - AI
tags:
  - 深度学习
---

官方中文文档：https://nni.readthedocs.io/zh/latest/

NNI(Neural Network Intelligence) 

## 概念

- *Experiment（实验）*： 表示一次任务，例如，寻找模型的最佳超参组合，或最好的神经网络架构等。 它由 Trial 和自动机器学习算法所组成。
- *搜索空间*：是模型调优的范围。 例如，超参的取值范围。
- *Configuration（配置）*：配置是来自搜索空间的实例，每个超参都会有特定的值。
- *Trial*：是一次独立的尝试，它会使用某组配置（例如，一组超参值，或者特定的神经网络架构）。 Trial 会基于提供的配置来运行。
- *Tuner（调优器）*：一种自动机器学习算法，会为下一个 Trial 生成新的配置。 新的 Trial 会使用这组配置来运行。
- *Assessor（评估器）*：分析 Trial 的中间结果（例如，定期评估数据集上的精度），来确定 Trial 是否应该被提前终止。
- *训练平台*：是 Trial 的执行环境。 根据 Experiment 的配置，可以是本机，远程服务器组，或其它大规模训练平台（如，OpenPAI，Kubernetes）。

## 步骤

步骤一：[定义搜索空间](https://nni.readthedocs.io/zh/latest/Tutorial/SearchSpaceSpec.html)

```json
{
    "dropout_rate":{"_type":"uniform","_value":[0.1,0.5]},
    "conv_size":{"_type":"choice","_value":[2,3,5,7]},
    "hidden_size":{"_type":"choice","_value":[124, 512, 1024]},
    "learning_rate":{"_type":"uniform","_value":[0.0001, 0.1]}
}
```



步骤二：[改动模型代码](https://nni.readthedocs.io/zh/latest/TrialExample/Trials.html)

```python
# 导入nni
import nni

# 从Tuner获得参数值
# RECEIVED_PARAMS 是一个对象，如：
# {"conv_size": 2, "hidden_size": 124, "learning_rate": 0.0307, "dropout_rate": 0.2029}
RECEIVED_PARAMS = nni.get_next_parameter()

# 定期返回指标数据（可选）
# metrics 可以是任意的 Python 对象。 
# 如果使用了 NNI 内置的 Tuner/Assessor，指标 只可以是两种类型：
#     1) 数值类型，如 float、int， 
#     2) dict 对象，其中必须由键名为 default ，值为数值的项目。 
# metrics 会发送给 assessor。 
# 通常，metrics 包含了定期评估的损失值或精度。
nni.report_intermediate_result(metrics)

# 返回配置的最终性能
# metrics 格式和 report_intermediate_result 中一样，这个数值表示模型的性能，如精度、损失值等。 
# metrics 会发送给 tuner。
nni.report_final_result(metrics)

```



步骤三：[定义实验配置](https://nni.readthedocs.io/zh/latest/Tutorial/ExperimentConfig.html)

## 常用方法

```python
import nni

params = nni.get_next_parameter()
nni.report_intermeidate_result(test_acc)
nni.report_final_result(test_acc)


```



$$\mathbf{w} = g \dfrac{\mathbf{v}}{\|\mathbf{v}\|}$$



